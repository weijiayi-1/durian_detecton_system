# 榴莲种类和成熟度检测系统

## 系统概述

这是一个基于YOLOv8的榴莲种类和成熟度检测系统，具有图形用户界面，支持图片、视频、文件夹批量检测和实时摄像头检测。
![image](https://github.com/user-attachments/assets/0ef8da66-5d6b-4a14-bca3-ea368463a704)


## 数据集获取

本项目使用的数据集可通过 Roboflow 平台获取：

- 榴莲成熟度数据集：[Durian Maturity Dataset (Roboflow)](https://universe.roboflow.com/wjy-tis6h/durian_mutruity)
- 榴莲种类数据集：[Durian Type Dataset (Roboflow)](https://universe.roboflow.com/skripsi-xtfuk/deteksi-jenis-durian)

请访问上述链接，注册或登录 Roboflow 账号后即可下载数据集。建议下载 YOLO 格式的数据，并放置到合适的训练目录下。

## 系统架构

### 文件结构
```
durian_detection_system/
├── config/
│   ├── __init__.py
│   └── settings.py          # 配置文件
├── gui/
│   ├── __init__.py
│   ├── main_window.py       # 主窗口
│   ├── detection_thread.py  # 检测线程
│   ├── settings_dialog.py   # 设置对话框
│   └── camera_widget.py     # 摄像头组件
├── models/
│   ├── __init__.py
│   ├── durian_detector.py   # 检测器
│   └── database.py          # 数据库管理
├── utils/
│   ├── __init__.py
│   └── helper.py            # 辅助工具
├── main.py                  # 主程序入口
├── test_gui.py             # GUI测试脚本
└── README.md               # 说明文档
```

### 核心组件

1. **主窗口 (main_window.py)**
   - 提供标签页界面，分离文件检测和摄像头检测
   - 集成设置对话框和检测线程
   - 管理UI状态和用户交互

2. **检测线程 (detection_thread.py)**
   - 独立的检测线程，避免UI阻塞
   - 支持图片、视频、文件夹和摄像头检测
   - 可配置置信度和IOU阈值

3. **设置对话框 (settings_dialog.py)**
   - 置信度阈值设置 (0.01-1.0)
   - IOU阈值设置 (0.01-1.0)
   - 滑块和数字输入框双重控制

4. **摄像头组件 (camera_widget.py)**
   - 自动检测可用摄像头
   - 实时视频预览
   - 摄像头参数配置

5. **检测器 (durian_detector.py)**
   - 集成YOLOv8模型
   - 支持置信度和IOU参数配置
   - 种类和成熟度双重检测

## 功能特性

### 检测功能
- ✅ 单张图片检测
- ✅ 文件夹批量检测
- ✅ 视频文件检测
- ✅ 实时摄像头检测
- ✅ 置信度阈值调节
- ✅ IOU阈值调节
- ✅ 检测结果可视化
- ✅ 检测结果数据库存储

### 用户界面
- ✅ 标签页分离文件检测和摄像头检测
- ✅ 设置对话框
- ✅ 进度条显示
- ✅ 实时结果显示
- ✅ 摄像头选择和控制

### 技术特性
- ✅ 多线程检测，UI不阻塞
- ✅ 可配置的检测参数
- ✅ 自动摄像头检测
- ✅ 错误处理和用户提示
- ✅ 资源管理和清理

## 使用方法

### 安装依赖
```bash
pip install PyQt5 ultralytics opencv-python numpy
```

### 运行程序
```bash
# 方法1: 使用主程序
python main.py

# 方法2: 使用测试脚本
python test_gui.py
```

### 操作指南

1. **文件检测**
   - 点击"文件检测"标签页
   - 选择"检测设置"配置置信度和IOU阈值
   - 点击"选择图片"、"选择文件夹"或"选择视频"
   - 等待检测完成，查看结果

2. **摄像头检测**
   - 点击"摄像头检测"标签页
   - 选择可用摄像头
   - 点击"开始检测"启动摄像头预览
   - 点击"开始实时检测"进行实时检测
   - 点击"停止检测"结束检测

3. **参数设置**
   - 点击"检测设置"按钮
   - 调整置信度阈值（推荐0.3-0.8）
   - 调整IOU阈值（推荐0.3-0.7）
   - 点击"确定"保存设置

## 配置说明

### 置信度阈值 (Confidence Threshold)
- **作用**: 控制检测结果的可靠性
- **范围**: 0.01-1.0
- **建议**: 
  - 0.3-0.5: 检测更多目标，可能有误检
  - 0.5-0.7: 平衡检测率和准确率
  - 0.7-0.9: 只检测高置信度目标

### IOU阈值 (IOU Threshold)
- **作用**: 控制重叠检测框的合并
- **范围**: 0.01-1.0
- **建议**:
  - 0.3-0.5: 宽松合并，减少重复检测
  - 0.5-0.7: 标准设置
  - 0.7-0.9: 严格合并，保留更多检测框

## 开发说明

### 添加新功能
1. 在相应模块中添加功能代码
2. 更新主窗口集成新功能
3. 添加必要的UI组件
4. 测试功能完整性

### 修改检测参数
1. 编辑 `config/settings.py` 中的默认配置
2. 更新 `models/durian_detector.py` 中的检测逻辑
3. 测试参数效果

### 扩展模型支持
1. 在 `config/settings.py` 中添加新模型路径
2. 更新 `models/durian_detector.py` 中的模型加载逻辑
3. 添加相应的类别映射

## 故障排除

### 常见问题

1. **摄像头无法打开**
   - 检查摄像头是否被其他程序占用
   - 尝试不同的摄像头索引
   - 确认摄像头驱动正常

2. **检测速度慢**
   - 降低视频分辨率
   - 调整检测频率
   - 使用GPU加速（如果可用）

3. **检测结果不准确**
   - 调整置信度阈值
   - 检查模型文件是否正确
   - 确认输入图像质量

4. **程序崩溃**
   - 检查依赖包版本兼容性
   - 确认模型文件存在
   - 查看错误日志

### 性能优化建议

1. **硬件要求**
   - CPU: 4核心以上
   - 内存: 8GB以上
   - GPU: 支持CUDA的显卡（可选）

2. **软件优化**
   - 使用最新版本的ultralytics
   - 启用GPU加速
   - 优化图像预处理

## 版本历史

### v1.0 (当前版本)
- 重构GUI代码，分离为多个模块
- 添加置信度和IOU设置功能
- 集成摄像头实时检测
- 改进用户界面和用户体验
- 添加错误处理和资源管理


## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至项目维护者 
